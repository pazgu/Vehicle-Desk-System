<div class="page-container">
  <div class="login-box">
    <a routerLink="/login" routerLinkActive="active"
      ><div class="close-btn">✕</div></a
    >
    <h2>יצירת משתמש חדש</h2>

    <form [formGroup]="registerForm" (ngSubmit)="register()" class="form-grid">
    <div>
        <label>שם פרטי</label>
        <input type="text" formControlName="first_name" (keypress)="preventSpaces($event)" />
        <small
          *ngIf="f['first_name'].touched && f['first_name'].errors?.['required']"
          style="color: red"
          >חובה להזין שם פרטי</small
        >
        <small *ngIf="f['first_name'].errors?.['minlength'] && !f['first_name'].errors?.['pattern']" style="color: red"
          >לפחות 2 אותיות</small
        >
        <small *ngIf="f['first_name'].errors?.['pattern']" style="color: red"
          >רק אותיות בעברית או באנגלית</small
        >
        <small *ngIf="f['first_name'].errors?.['mixedLanguage']" style="color: red">
           לא ניתן לערבב עברית ואנגלית
        </small>
      </div>

     <div>
        <label>שם משפחה</label>
        <input type="text" formControlName="last_name" (keypress)="preventSpaces($event)" />
        <small
          *ngIf="f['last_name'].touched && f['last_name'].errors?.['required']"
          style="color: red"
          >חובה להזין שם משפחה</small
        >
        <small *ngIf="f['last_name'].errors?.['minlength'] && !f['last_name'].errors?.['pattern']" style="color: red"
          >לפחות 2 אותיות</small
        >
        <small *ngIf="f['last_name'].errors?.['pattern']" style="color: red"
          >רק אותיות בעברית או באנגלית</small
        >
        <small *ngIf="f['last_name'].errors?.['mixedLanguage']" style="color: red">
             לא ניתן לערבב עברית ואנגלית
        </small>
      </div>

<div>
        <label>שם משתמש</label>
        <input type="text" formControlName="username" (keypress)="preventSpaces($event)" />
        <small
          *ngIf="f['username'].touched && f['username'].errors?.['required']"
          style="color: red"
          >חובה להזין שם משתמש</small
        >
        <small *ngIf="getUsernameErrors()" style="color: red;">
          {{ getUsernameErrors() }}
        </small>
      </div>

      <div>
        <label>כתובת מייל</label>
        <input type="email" formControlName="email" (keypress)="preventSpaces($event)" />
        <small
          *ngIf="
            (f['email'].touched ||
              f['email'].dirty) &&
            f['email'].hasError('required')
          "
          class="error"
        >
          חובה להזין אימייל
        </small>
        <small
          *ngIf="
            (f['email'].touched ||
              f['email'].dirty) &&
            f['email'].hasError('invalidEmail')
          "
          class="error"
        >
          אימייל לא תקין
        </small>
      </div>

       <div>
        <label>מספר טלפון</label>
        <input type="tel" formControlName="phone" (keypress)="preventSpaces($event)" />
        <small
          *ngIf="f['phone'].touched && f['phone'].errors?.['required']"
          style="color: red"
          >חובה להזין מספר טלפון</small
        >
        <small *ngIf="getPhoneErrors()" style="color: red;">
          {{ getPhoneErrors() }}
        </small>
      </div>

      <div>
        <label>סיסמה</label>
        <div class="password-container">
          <input
            [type]="showPassword ? 'text' : 'password'"
            formControlName="password"
            class="password-input"
            (keypress)="preventSpaces($event)"
          />
          <mat-icon class="show-password" (click)="togglePassword()">
            {{ showPassword ? "visibility" : "visibility_off" }}
          </mat-icon>
        </div>
        <small
          *ngIf="f['password'].touched && f['password'].errors?.['required']"
          style="color: red"
          >חובה להזין סיסמה</small
        >
        <small *ngIf="getPasswordErrors()" style="color: red;">
          {{ getPasswordErrors() }}
        </small>
      </div>

      <div>
        <label>מחלקה</label>
        <select formControlName="department_id">
          <option value="">לחץ.י לבחירת מחלקה</option>
          <option *ngFor="let dept of departments" [value]="dept.id">
            {{ dept.name }}
          </option>
        </select>
        <small
          *ngIf="f['department_id'].touched && f['department_id'].errors?.['required']"
          style="color: red"
          >חובה לבחור מחלקה</small
        >
      </div>

      <button type="submit">צור משתמש</button>
      <p *ngIf="errorMessage" style="color: red">{{ errorMessage }}</p>
    </form>
  </div>
</div>

<router-outlet></router-outlet>
