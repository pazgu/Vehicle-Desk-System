<div class="page-container">
  <div class="orders-wrapper">
    <div class="page-header">
      <h1>הזמנות המחלקה</h1>

      <button class="back-button" (click)="goBack()">
        חזור
        <i class="pi pi-arrow-left"></i>
      </button>
    </div>

    <div class="filter-controls-bar">
      <div class="sort-control">
        <label for="sort">מיין לפי: </label>
        <select
          id="sort"
          class="filter-select"
          [(ngModel)]="sortBy"
          (change)="updateQueryParams()"
        >
          <option value="submitted_at">נוסף לאחרונה</option>
          <option value="date_and_time">תאריך</option>
          <option value="status">סטטוס</option>
        </select>
      </div>

      <button class="filter-btn" (click)="showFilters = !showFilters">
        <i class="pi pi-filter"></i>
        <span>{{ showFilters ? "הסתר סינון" : "הצג סינון" }}</span>
      </button>
    </div>

    <div *ngIf="showFilters" class="filters-panel">
      <div class="filters-row">
        <div class="filter-group">
          <label for="statusFilter">סטטוס:</label>
          <select
            id="statusFilter"
            class="filter-select"
            [(ngModel)]="statusFilter"
            (ngModelChange)="onFilterChange()"
            (change)="updateQueryParams()"
          >
            <option value="">הצג הכל</option>
            <option value="מאושר">מאושר</option>
            <option value="בהמתנה">בהמתנה</option>
            <option value="נדחה">נדחה</option>
            <option value="בוטל">בוטל</option>
            <option value="בוצע">בוצע</option>
          </select>
        </div>

        <div class="date-input-group">
          <label for="startDate">מתאריך:</label>
          <input
            id="startDate"
            type="date"
            class="filter-date"
            [(ngModel)]="startDate"
            (ngModelChange)="validateDates()"
            (change)="updateQueryParams()"
            [max]="endDate || null"
          />
        </div>
        <div class="date-input-group">
          <label for="endDate">עד תאריך:</label>
          <input
            id="endDate"
            type="date"
            class="filter-date"
            [(ngModel)]="endDate"
            (ngModelChange)="validateDates()"
            (change)="updateQueryParams()"
            [min]="startDate || null"
          />
        </div>

        <div *ngIf="dateError" style="color: red; margin-top: 5px">
          תאריך ההתחלה לא יכול להיות אחרי תאריך הסיום
        </div>
      </div>
    </div>

    <div class="status-indicators">
      <p style="margin-bottom: 0.75rem; font-weight: 600">מקרא צבעים</p>
      <div class="status-box">
        <div class="status-item">
          <span class="status-indicator approved"></span> מאושר
        </div>
        <div class="status-item">
          <span class="status-indicator completed"></span> בוצע
        </div>
        <div class="status-item">
          <span class="status-indicator pending"></span> בהמתנה
        </div>
        <div class="status-item">
          <span class="status-indicator rejected"></span> נדחה
        </div>
        <div class="status-item">
          <span class="status-indicator cancelled"></span>בוטלה-נסיעה לא יצאה
        </div>
      </div>
    </div>

    <div *ngIf="filteredOrders.length > 0">
      <div class="orders-header-row">
        <div class="icon-cell"></div>
        <div class="cell">מזהה נסיעה</div>
        <div class="cell">שם עובד</div>
        <div class="cell">רכב</div>
        <div class="cell">תאריך</div>
        <div class="cell">מרחק (ק"מ)</div>
        <div class="cell">סטטוס</div>
      </div>

      <div
        class="orders-data-row"
        *ngFor="let trip of trips"
        (click)="onRowSelect(trip)"
        [ngClass]="getRowClass(trip.status)"
        style="cursor: pointer"
      >
        <div class="icon-cell">
          <div class="duration-indicator-inline">
            {{ getDurationIndicator(trip) }}
          </div>
        </div>

        <div class="cell">
          <button
            class="copy-button"
            (click)="copyToClipboard(trip.ride_id); $event.stopPropagation()"
          >
            <img class="copy-icon" src="/assets/images/copy.png" />
            <span *ngIf="copiedRideId === trip.ride_id" class="copied-message"
              >Copied!</span
            >
          </button>
          <span class="ride-id-text">{{ trip.ride_id.slice(0, 4) }}...</span>
        </div>

        <div class="cell">{{ trip.employee_name }}</div>
        <div class="cell">{{ trip.requested_vehicle_model }}</div>
        <div class="cell">
          {{ trip.date_and_time | date : "dd/MM/yyyy HH:mm" }}
        </div>
        <div class="cell">{{ trip.distance }}</div>
        <div class="cell" [ngClass]="getStatusClass(trip.status)">
          {{ translateStatus(trip.status) }}
        </div>
      </div>

      <div *ngIf="trips.length === 0" class="no-orders-message">
        לא נמצאו הזמנות
      </div>
    </div>

    <div class="pagination-controls">
      <button (click)="prevPage()" [disabled]="currentPage === 1">
        <span class="icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z" />
          </svg>
        </span>
      </button>

      <span>עמוד {{ currentPage }} מתוך {{ totalPages }}</span>
      <button (click)="nextPage()" [disabled]="currentPage === totalPages">
        <span class="icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
          </svg>
        </span>
      </button>
    </div>
  </div>
</div>
