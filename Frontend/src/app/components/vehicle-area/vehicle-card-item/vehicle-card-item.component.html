<div class="vehicle-details-wrapper">
  <div class="vehicle-wrapper-header">
    <h1>×¤×¨×˜×™ ×¨×›×‘</h1>
    <button class="back-btn" (click)="goBack()">×—×–×•×¨ â†</button>
  </div>
  <br />

  <div class="vehicle-details-content">
    <p-card *ngIf="vehicle" class="vehicle-details-card" [ngClass]="getCardClass(vehicle.status)">
      <div class="vehicle-horizontal-content">
        <div class="right-side">
          <div class="usage-line">
            <div class="usage-indicator" [style.background-color]="getUsageBarColor(vehicle.plate_number)"></div>
            <span class="usage-number" *ngIf="getVehicleUsageCount(vehicle.plate_number) > 0">
              {{ getVehicleUsageCount(vehicle.plate_number) }} × ×¡×™×¢×•×ª ×§×™×™××•×ª ×œ×¨×›×‘ ×–×”
            </span>
          </div>
          <img *ngIf="vehicle.image_url" [src]="vehicle.image_url" alt="×ª××•× ×” ×©×œ ×”×¨×›×‘" class="vehicle-details-img" />
        </div>

        <div class="vehicle-details-info">
          <h2>×¨×›×‘: {{ vehicle.plate_number }}</h2>
          <div *ngIf="isLeaseExpired(vehicle.lease_expiry)" class="lease-expired-warning">
            <mat-icon color="warn">warning</mat-icon> ×—×•×–×” ×”×”×©×›×¨×” ×¤×’
          </div>
          <p><strong>×“×’×:</strong> {{ vehicle.vehicle_model }}</p>
          <p><strong>×¡×˜×˜×•×¡:</strong> {{ translateStatus(vehicle.status) }}</p>
          <p><strong>×¡×•×’ ×¨×›×‘:</strong> {{ translateType(vehicle.type) }}</p>
          <p><strong>×¡×•×’ ×“×œ×§:</strong> {{ translateFuelType(vehicle.fuel_type) }}</p>
          <p>
            <strong>×¤×¢× ××—×¨×•× ×” ×‘×©×™××•×©:</strong>
            {{ formatLastUsedAt(vehicle.last_used_at) }}
          </p>
          <p><strong>××™×§×•× × ×•×›×—×™:</strong> {{ vehicle.current_location }}</p>
          <p><strong>××—×œ×§×”:</strong> {{ departmentName || '×œ× ××©×•×™×™×š ×œ××—×œ×§×”' }}</p>

          <p *ngIf="vehicle.reason_for_4x4">
            <strong>×¡×™×‘×ª 4x4:</strong> {{ vehicle.reason_for_4x4 }}
          </p>

          <p *ngIf="vehicle.status === 'frozen' && vehicle.freeze_reason">
            <strong>×¡×™×‘×ª ×”×§×¤××”:</strong> {{ translateFreezeReason(vehicle.freeze_reason) }}
          </p>

          <p><strong>×§×´×:</strong> {{ vehicle.odometer_reading }}</p>
          <p><strong>××¡×¤×¨ × ×¡×™×¢×•×ª ×œ×—×•×“×© ×–×”:</strong> {{ currentVehicleRideCount }}</p>
          <p><strong>××—×•×– × ×¡×™×¢×•×ª ×œ×—×•×“×© ×–×”:</strong></p>
          <div class="ride-progress">
            <span>{{ (currentVehicleRideCount / 20) * 100 | number:'1.0-0' }}%</span>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="(currentVehicleRideCount / 20) * 100"></div>
            </div>
          </div>

          <p><strong>×ª×•×§×£ ×—×•×–×” ×”×©×›×¨×”:</strong>
            {{ vehicle.lease_expiry ? (vehicle.lease_expiry | date: 'dd/MM/yyyy') : '×œ× ×¡×•×¤×§' }}
          </p>

          <!-- Unfreeze button -->
          <button class="unfreeze-button button-spacing" (click)="updateVehicleStatus('available')"
            *ngIf="vehicle.status === 'frozen'">
            ×©×—×¨×•×¨ ××”×§×¤××”
          </button>

          <!-- Freeze logic -->
          <div *ngIf="vehicle.status === 'in-use' || vehicle.status === 'available'">
            <button class="freeze-button button-spacing" (click)="showFreezeReasonField()">
              ×”×§×¤× ×¨×›×‘
            </button>

            <div *ngIf="isFreezeReasonFieldVisible" class="freeze-reason-container">
              <select [(ngModel)]="freezeReason" class="freeze-reason-dropdown">
                <option value="" disabled selected>×‘×—×¨ ×¡×™×‘×ª ×”×§×¤××”</option>
                <option value="maintenance">×ª×—×–×•×§×”</option>
                <option value="accident">×ª××•× ×”</option>
                <option value="personal">××™×©×™</option>
              </select>
              <button class="confirm-freeze-button button-spacing" (click)="freezeStatus()">
                ××™×©×•×¨ ×”×§×¤××”
              </button>
            </div>
          </div>

          <!-- âœ… Split Delete & Archive Buttons -->
          <!-- ğŸ§Š Archive button -->
          <button
            *ngIf="vehicle.status === 'frozen' && isLeaseExpired(vehicle.lease_expiry) && vehicle.canDelete"
            class="freeze-button"
            (click)="confirmArchive(vehicle)"
            title="×”×¨×›×‘ ××•×§×¤× â€“ × ×™×ª×Ÿ ×œ××¨×›×‘">
            ××¨×›×•×‘ ×¨×›×‘
          </button>

          <!-- ğŸ—‘ Delete button -->
          <button
            *ngIf="vehicle.status !== 'frozen' && vehicle.status !== 'in_use' && isLeaseExpired(vehicle.lease_expiry) && vehicle.canDelete"
            class="freeze-button"
            (click)="confirmDelete(vehicle)"
            title="×ª×•×§×£ ×”×—×•×–×” ×¤×’ â€“ × ×™×ª×Ÿ ×œ××—×•×§">
            ××—×™×§×ª ×¨×›×‘
          </button>

          <button class="timeline-button-inline button-spacing" (click)="navigateToTimeline()">
            ×¦×¤×” ×‘×œ×•×— ×”×–×× ×™×
          </button>
        </div>

      </div>
    </p-card>


  </div>
</div>