<div *ngIf="loading" class="loading">טוען...</div>

<div *ngIf="!loading" class="admin-inspections-container">
  <h1 style="text-align: right; color: #942222; margin-bottom: 1rem;">חריגות</h1>
  <div class="problematic-only-filter" dir="rtl">
    <button (click)="showProblematicFilters = !showProblematicFilters">
      {{ showProblematicFilters ? 'הסתר אפשרויות סינון' : 'הצג בדיקות עם בעיות' }}
    </button>
    <div *ngIf="showProblematicFilters">
      <label style="cursor:pointer; margin-bottom: 0.5em;">
        <input type="checkbox" [(ngModel)]="showMediumIssues" (change)="loadData()" />
        הצג בעיות - דרגה בינונית
      </label>
      <label style="cursor: pointer; display: block;">
        <input type="checkbox" [(ngModel)]="showCriticalIssues" (change)="loadData()" />
        הצג בעיות - דרגה חריגה
      </label>
    </div>
  </div>

  <!-- Inspections Table -->
  <div class="table"></div>
  <h2 style="text-align: right; color: #942222; margin-top: 0.5rem; margin-bottom: 1rem;">בדיקות רכבים</h2>
  <table class="inspection-table">
    <thead>
      <tr>
        <th>תאריך</th>    
        <th>בודק</th>
        <th>נקי</th>
        <th>מתודלק</th>
        <th>אין חפצים</th>
        <th>בעיה קריטית</th>
        <th>הערות</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let insp of pagedInspections">
        <td>{{ insp.inspection_date | date: 'short' }}</td>
        <td>{{ insp.inspected_by_name || '—' }}</td>
        <td>{{ insp.clean ? '✔️' : '❌' }}</td>
        <td>{{ insp.fuel_checked ? '❌' : '✔️' }}</td>
        <td>{{ insp.no_items_left ? '✔️' : '❌' }}</td>
        <td>{{ insp.critical_issue_bool ? 'כן' : 'לא' }}</td>
        <td>{{ insp.issues_found || '—' }}</td>
      </tr>
      <tr *ngIf="filteredInspections.length === 0 && !loading">
        <td colspan="7" class="empty-state">לא נמצאו בדיקות רכב</td>
      </tr>
    </tbody>
  </table>


  <div class="pagination-controls">
    <button (click)="prevPage()" [disabled]="currentPage === 1">
      ▶
    </button>
    <span>עמוד {{ currentPage }} מתוך {{ totalPages }}</span>
    <button (click)="nextPage()" [disabled]="currentPage === totalPages">
      ◀
    </button>
  </div>
</div>