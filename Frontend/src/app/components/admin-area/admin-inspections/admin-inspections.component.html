<h2 class="section-title" *ngIf="!isCriticalMode">×‘×“×™×§×•×ª ×¨×›×‘×™× ×©×‘×•×¦×¢×• ×”×™×•×</h2>
<h2 class="section-title" *ngIf="isCriticalMode">×—×¨×™×’×•×ª</h2>

<div *ngIf="loading" class="loading">×˜×•×¢×Ÿ...</div>

<div class="admin-inspections-container" *ngIf="!loading">

  <div class="problematic-only-filter" dir="rtl">
    <button (click)="showProblematicFilters = !showProblematicFilters">
      {{ showProblematicFilters ? '×”×¡×ª×¨ ××¤×©×¨×•×™×•×ª ×¡×™× ×•×Ÿ' : '×”×¦×’ ×‘×“×™×§×•×ª ×¢× ×‘×¢×™×•×ª' }}
    </button>

    <div *ngIf="showProblematicFilters">
      <label style="display: block; margin-bottom: 0.5em;">
        <input type="checkbox" [(ngModel)]="showMediumIssues" (change)="loadInspections()" />
        ×”×¦×’ ×‘×¢×™×•×ª - ×“×¨×’×” ×‘×™× ×•× ×™×ª
      </label>
      <label style="display: block;">
        <input type="checkbox" [(ngModel)]="showCriticalIssues" (change)="loadInspections()" />
        ×”×¦×’ ×‘×¢×™×•×ª - ×“×¨×’×” ×—×¨×™×’×”
      </label>
    </div>
  </div>

  <div *ngIf="inspections.length === 0 && !anyFiltersSelected()" class="empty">
    ××™×Ÿ ×‘×“×™×§×•×ª ×œ×”×¦×’×”
  </div>

  <div *ngIf="inspections.length === 0 && anyFiltersSelected()" class="empty-filtered-results">
    ××™×Ÿ ×‘×“×™×§×•×ª ×ª×•×××•×ª ×œ×ª× ××™ ×”×¡×™× ×•×Ÿ ×©× ×‘×—×¨×•.
  </div>

  <table class="inspection-table" *ngIf="inspections.length > 0">
  <thead>
    <tr *ngIf="isCriticalMode">
      <th>ğŸ“… ×ª××¨×™×š</th>
      <th>ğŸ§¾ ×¡×•×’</th>
      <th>ğŸ‘¤ ××—×¨××™</th>
      <th>ğŸš— ×¨×›×‘</th>
      <th>ğŸ“ ×ª×™××•×¨</th>
    </tr>
    <tr *ngIf="!isCriticalMode">
      <th>ğŸ“… ×ª××¨×™×š</th>
      <th>ğŸ§ª ×‘×•×“×§</th>
      <th>ğŸ“ ×”×¢×¨×•×ª</th>
    </tr>
  </thead>
  <tbody>
<tr *ngFor="let item of inspections"
    [class.highlight]="highlighted"
    (click)="isCriticalMode ? loadIssueDetails(item) : selectedIssue = item">

      <!-- Critical Mode -->
      <td *ngIf="isCriticalMode">{{ item.timestamp | date: 'short' }}</td>
      <td *ngIf="isCriticalMode">{{ item.source_type }}</td>
      <td *ngIf="isCriticalMode">{{ item.responsible_user }}</td>
      <td *ngIf="isCriticalMode">{{ item.vehicle_info || 'â€”' }}</td>
      <td *ngIf="isCriticalMode">{{ item.issue_summary }}</td>

      <!-- Daily Inspection Mode -->
      <td *ngIf="!isCriticalMode">{{ item.inspection_date | date: 'short' }}</td>
      <td *ngIf="!isCriticalMode">{{ item.inspected_by }}</td>
      <td *ngIf="!isCriticalMode">{{ item.issues_found || '×œ× ×“×•×•×—×• ×‘×¢×™×•×ª' }}</td>
    </tr>
  </tbody>
</table>

<div class="modal-overlay" *ngIf="selectedIssueDetails && isCriticalMode" (click)="selectedIssueDetails = null">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="selectedIssueDetails = null">Ã—</button>

    <h3>ğŸ” ×¤×™×¨×•×˜ ×”×—×¨×™×’×”</h3>
    <p><strong>×ª×™××•×¨ ××œ×:</strong> {{ selectedIssueDetails.issue_text }}</p>
    <p><strong>×¨×›×‘:</strong> {{ selectedIssueDetails.vehicle_id || 'â€”' }}</p>
    <p><strong>××—×¨××™:</strong> {{ selectedIssueDetails.submitted_by }}</p>
    <p><strong>×ª××¨×™×š:</strong> {{ selectedIssueDetails.timestamp | date:'medium' }}</p>
    <p><strong>×¡×•×’:</strong> {{ selectedIssueDetails.type }}</p>
  </div>
</div>




</div>