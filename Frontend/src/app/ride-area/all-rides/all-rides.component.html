<div class="page-container">
  <div
    class="exceeded-rides-warming"
    *ngIf="exceededMaxRides() && warningVisible"
  >
    <h2>тЪая╕П╫й╫Щ╫Э ╫Ь╫СтЪая╕П</h2>
    <p>
      ╫С╫Ч╫Х╫У╫й ╫Ф╫Р╫Ч╫и╫Х╫Я ╫С╫Щ╫ж╫в╫к ╫Ю╫в╫Ь 6 ╫Ф╫Ц╫Ю╫а╫Х╫к ╫и╫Ы╫С ╫д╫и╫Ш╫Щ. <br />
      ╫в╫Ь ╫д╫Щ ╫Ф╫к╫з╫а╫Х╫Я ╫Ю╫Ы╫Р╫Я ╫к╫ж╫Ш╫и╫Ъ ╫Ь╫й╫Ь╫Э ╫в╫ж╫Ю╫Р╫Щ╫к ╫в╫Ь ╫а╫б╫Щ╫в╫Х╫к ╫д╫и╫Ш╫Щ╫Х╫к ╫а╫Х╫б╫д╫Х╫к ╫Ь╫Ч╫Х╫У╫й ╫Ц╫Ф
    </p>
    <button (click)="hideWarning()">╫Ф╫б╫к╫и</button>
  </div>

  <div
    class="floating-warning-container"
    *ngIf="!warningVisible && exceededMaxRides()"
  >
    <button (click)="showWarning()">тЪая╕П</button>
  </div>

  <div class="quota-float" dir="rtl">
    <div
      class="free-quota-indicator"
      [class.exceeded]="freeQuotaExceeded"
      aria-label="╫Ю╫Ы╫б╫к ╫Ф╫Ц╫Ю╫а╫Х╫к ╫Ч╫Щ╫а╫Ю╫Щ╫Х╫к"
    >
      <div class="fq-header">
        <span class="fq-title">╫Ю╫Ы╫б╫к ╫Ф╫Ц╫Ю╫а╫Х╫к ╫Ч╫Щ╫а╫Ю╫Щ╫Х╫к</span>
        <span class="fq-count">{{ freeQuotaUsed }}/{{ freeQuotaTotal }}</span>
      </div>

      <div class="fq-segments" [style.--fq-total]="freeQuotaTotal">
        <div
          class="fq-segment"
          *ngFor="let i of quotaSegments; let idx = index"
          [class.filled]="idx < freeQuotaUsed"
          [attr.title]="'╫д╫и╫Щ╫Ш ' + (idx + 1) + ' ╫Ю╫к╫Х╫Ъ ' + freeQuotaTotal"
        ></div>
      </div>

      <div class="fq-hint" *ngIf="freeQuotaExceeded">
        ╫Ф╫Т╫в╫к ╫Ь╫Ю╫Ы╫б╫Ф тАФ ╫Ф╫Ц╫Ю╫а╫Х╫к ╫а╫Х╫б╫д╫Х╫к ╫С╫к╫й╫Ь╫Х╫Э
      </div>
    </div>
    <small> * ╫и╫з 6 ╫а╫б╫Щ╫в╫Х╫к ╫С╫Ч╫Х╫У╫й ╫Ф╫Я ╫в╫Ь ╫Ч╫й╫С╫Х╫Я ╫Ф╫Ю╫в╫и╫Ы╫к </small>
  </div>

  <div class="orders-wrapper">
    <div id="header-wrap">
      <h1>╫Ф╫Ф╫Ц╫Ю╫а╫Х╫к ╫й╫Ь╫Щ</h1>
      <button class="back-btn" (click)="goBack()">╫Ч╫Ц╫Х╫и тЖР</button>
    </div>

    <br />
    <div class="ride-filter-buttons">
      <button
        [ngClass]="{ active: rideViewMode === 'future' }"
        (click)="rideViewMode = 'future'; applyFiltersAndSort()"
      >
        ╫Ф╫ж╫Т ╫а╫б╫Щ╫в╫Х╫к ╫в╫к╫Щ╫У╫Щ╫Х╫к
      </button>
      <button
        [ngClass]="{ active: rideViewMode === 'past' }"
        (click)="rideViewMode = 'past'; applyFiltersAndSort()"
      >
        ╫Ф╫ж╫Т ╫а╫б╫Щ╫в╫Х╫к ╫з╫Х╫У╫Ю╫Х╫к
      </button>
      <button
        [ngClass]="{ active: rideViewMode === 'all' }"
        (click)="rideViewMode = 'all'; applyFiltersAndSort()"
      >
        ╫Ф╫ж╫Т ╫Ф╫Ы╫Ь
      </button>
    </div>

    <div
      style="
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
        direction: rtl;
      "
    >
      <div>
        <label for="sort">╫Ю╫Щ╫Щ╫Я ╫Ь╫д╫Щ: </label>
        <select id="sort" [(ngModel)]="sortBy" (change)="applyFiltersAndSort()">
          <option value="recent">╫а╫Х╫б╫г ╫Ь╫Р╫Ч╫и╫Х╫а╫Ф</option>
          <option value="date">╫к╫Р╫и╫Щ╫Ъ</option>
          <option value="status">╫б╫Ш╫Ш╫Х╫б</option>
        </select>
      </div>

      <button class="filter" (click)="toggleFiltersVisibility()">
        {{ showFilters ? "╫Ф╫б╫к╫и ╫б╫Щ╫а╫Х╫Я" : "╫Ф╫ж╫Т ╫б╫Щ╫а╫Х╫Я" }}
      </button>
    </div>

    <div
      *ngIf="showFilters"
      style="
        margin-bottom: 1.5rem;
        background: #f7f7f7;
        padding: 1rem;
        border-radius: 8px;
      "
    >
      <div style="margin-bottom: 1rem">
        <label for="statusFilter">╫б╫Ш╫Ш╫Х╫б:</label>
        <select
          id="statusFilter"
          [(ngModel)]="statusFilter"
          (change)="applyFiltersAndSort()"
        >
          <option value="">╫Ф╫ж╫Т ╫Ф╫Ы╫Ь</option>
          <option value="approved">╫Ю╫Р╫Х╫й╫и</option>
          <option value="pending">╫Ю╫Ю╫к╫Щ╫Я</option>
          <option value="cancelled_due_to_no_show">╫С╫Х╫Ш╫Ь╫Ф-╫а╫б╫Щ╫в╫Ф ╫Ь╫Р ╫Щ╫ж╫Р╫Ф</option>
          <option value="rejected">╫а╫У╫Ч╫Ф</option>
        </select>
      </div>

      <div style="display: flex; gap: 1rem">
        ╫Ф╫Ч╫Ь ╫Ю:
        <input
          id="startDate"
          type="date"
          [(ngModel)]="startDate"
          [min]="minDate"
          [max]="maxDate"
          (change)="validateDate('start'); applyFiltersAndSort()"
        />
        ╫в╫У:
        <input
          id="endDate"
          type="date"
          [(ngModel)]="endDate"
          [min]="minDate"
          [max]="maxDate"
          (change)="validateDate('end'); applyFiltersAndSort()"
        />

        <label *ngIf="rideViewMode !== 'future'">
          <input
            type="checkbox"
            [(ngModel)]="showOldOrders"
            (change)="applyFiltersAndSort()"
          />
          ╫Ф╫ж╫Т ╫Т╫Э ╫Ф╫Ц╫Ю╫а╫Х╫к ╫Ю╫Ь╫д╫а╫Щ ╫Ч╫Х╫У╫й
        </label>
      </div>
    </div>

    <div
      *ngIf="!loading && filteredOrders.length === 0"
      class="no-orders-message"
    >
      ╫Ь╫Р ╫а╫Ю╫ж╫Р╫Х ╫а╫б╫Щ╫в╫Х╫к ╫в╫С╫Х╫и ╫Ф╫Ю╫й╫к╫Ю╫й ╫Ф╫а╫Х╫Ы╫Ч╫Щ
      <button class="new-ride-btn" (click)="goToNewRide()">
        + ╫Ф╫Ц╫Ю╫Я ╫а╫б╫Щ╫в╫Ф ╫Ч╫У╫й╫Ф
      </button>
    </div>

    <div *ngIf="filteredOrders.length > 0">
      <div class="orders-header-row">
        <div class="icon-cell">╫б╫Ш╫Ш╫Х╫б</div>
        <div class="cell">╫к╫Р╫и╫Щ╫Ъ</div>
        <div class="cell">╫й╫в╫Ф</div>
        <div class="cell">╫б╫Х╫Т</div>
        <div class="cell">╫Ю╫и╫Ч╫з</div>
        <div class="cell">╫д╫в╫Х╫Ь╫Х╫к</div>
      </div>

      <div
        class="orders-data-row"
        *ngFor="let order of pagedOrders"
        [id]="order.ride_id"
        (click)="viewRide(order)"
        [ngClass]="[
          getStatusClass(order.status),
          isPastOrder(order) ? 'past-order' : '',
          isPaidOrder(order) ? 'paid-order' : '',
          isCompletedOrder(order) ? 'completed-order' : '',
          order.ride_id === highlightedOrderId
            ? 'highlight highlight-background'
            : '',
          order.hasStarted ? 'ride-started' : ''
        ]"
        [title]="
          isPaidOrder(order) ? '╫Ф╫Ц╫Ю╫а╫Ф ╫Ц╫Х ╫С╫к╫й╫Ь╫Х╫Э ╫в╫ж╫Ю╫Щ - ╫Ю╫в╫Ь 6 ╫Ф╫Ц╫Ю╫а╫Х╫к ╫Ф╫Ч╫Х╫У╫й' : ''
        "
        style="cursor: pointer"
      >
        <div class="icon-cell">
          <span
            class="pi"
            [ngClass]="{
             'pi-verified': !order.hasStarted &&order.status.toLowerCase() === 'approved',
             'pi-clock': !order.hasStarted &&order.status.toLowerCase() === 'pending',
             'pi-times-circle': !order.hasStarted &&order.status.toLowerCase() === 'rejected',
             'pi-list-check': !order.hasStarted &&order.status.toLowerCase() === 'completed',
             'pi-forward': !order.hasStarted &&order.status.toLowerCase() === 'in_progress',  

            }"
            [title]="getStatusTooltip(order.status)"
            style="font-size: 1.3rem"
          >
          </span>
          <img
            *ngIf="
              order.hasStarted && order.status.toLowerCase() === 'approved'
            "
            src="assets/images/timed-clock.gif"
            alt="Started"
            class="started-gif-icon"
          />
          <img
            *ngIf="order.status.toLowerCase() === 'cancelled_due_to_no_show'"
            src="assets/images/cancelled_no_show.png"
            alt="Cancelled due to No Show"
            class="cancelled-no-show-icon"
          />
        </div>

        <div class="cell">{{ order.date }}</div>

        <div class="cell">{{ order.time }}</div>

        <div class="cell">
          {{ order.type }}
          <span
            *ngIf="isPaidOrder(order)"
            style="color: #ffc107; font-weight: bold; margin-right: 8px"
          >
            ЁЯТ▓
          </span>
        </div>

        <div class="cell">{{ order.distance }}</div>

        <div class="cell ride-type-icon">
          <i title="╫а╫б╫Щ╫в╫Ф ╫й╫Ь ╫Щ╫Х╫к╫и ╫Ю╫Щ╫Х╫Э" *ngIf="checkIfOverOneDay(order)">
            <svg
              width="25"
              height="25"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <rect
                x="3"
                y="4"
                width="18"
                height="18"
                rx="2"
                stroke="currentColor"
                stroke-width="2"
              />
              <path d="M3 10H21" stroke="currentColor" stroke-width="2" />
              <path
                d="M8 2V6"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <path
                d="M16 2V6"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <text
                x="12"
                y="15"
                text-anchor="middle"
                dominant-baseline="central"
                font-family="system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif"
                font-size="12"
                font-weight="700"
                font-style="normal"
                fill="currentColor"
              >
                +1
              </text>
            </svg>
          </i>
          <i title="╫а╫б╫Щ╫в╫Ф ╫й╫Ь ╫Щ╫Х╫Э" *ngIf="!checkIfOverOneDay(order)"></i>
        </div>

        <div class="modify-buttons">
          <button
            class="modify"
            (click)="
              canEdit(order) ? editOrder(order) : null; $event.stopPropagation()
            "
            [disabled]="!canEdit(order)"
            [style.opacity]="canEdit(order) ? '1' : '0.5'"
            [style.cursor]="canEdit(order) ? 'pointer' : 'not-allowed'"
          >
            <i class="pi pi-pencil"></i>
          </button>

          <button
            class="delete"
            [disabled]="!canDelete(order)"
            [style.opacity]="canDelete(order) ? '1' : '0.5'"
            (click)="
              canDelete(order) ? deleteOrder(order) : null;
              $event.stopPropagation()
            "
            [style.cursor]="canDelete(order) ? 'pointer' : 'not-allowed'"
          >
            <i class="pi pi-trash"></i>
          </button>
        </div>
        <div></div>
        <div class="ride-type-icon">
          <i title="╫а╫б╫Щ╫в╫Ф ╫й╫Ь ╫Щ╫Х╫к╫и ╫Ю╫Щ╫Х╫Э" *ngIf="checkIfOverOneDay(order)">
            <svg
              width="25"
              height="25"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <rect
                x="3"
                y="4"
                width="18"
                height="18"
                rx="2"
                stroke="currentColor"
                stroke-width="2"
              />
              <path d="M3 10H21" stroke="currentColor" stroke-width="2" />
              <path
                d="M8 2V6"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <path
                d="M16 2V6"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <text
                x="12"
                y="15"
                text-anchor="middle"
                dominant-baseline="central"
                font-family="system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif"
                font-size="12"
                font-weight="700"
                font-style="normal"
                fill="currentColor"
              >
                +1
              </text>
            </svg>
          </i>
          <i title="╫а╫б╫Щ╫в╫Ф ╫й╫Ь ╫Щ╫Х╫Э" *ngIf="!checkIfOverOneDay(order)">
            <svg
              width="25"
              height="25"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <rect
                x="3"
                y="4"
                width="18"
                height="18"
                rx="2"
                stroke="currentColor"
                stroke-width="2"
              />
              <path d="M3 10H21" stroke="currentColor" stroke-width="2" />
              <path
                d="M8 2V6"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <path
                d="M16 2V6"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <text
                x="12"
                y="15"
                text-anchor="middle"
                dominant-baseline="central"
                font-family="system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif"
                font-size="12"
                font-weight="700"
                font-style="normal"
                fill="currentColor"
              >
                1
              </text>
            </svg>
          </i>
        </div>
      </div>
      <div class="pagination-controls">
        <button (click)="prevPage()" [disabled]="currentPage === 1">
          <span class="icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z" />
            </svg>
          </span>
        </button>

        <span>╫в╫Ю╫Х╫У {{ currentPage }} ╫Ю╫к╫Х╫Ъ {{ totalPages }}</span>
        <button (click)="nextPage()" [disabled]="currentPage === totalPages">
          <span class="icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
            </svg>
          </span>
        </button>
      </div>
    </div>
  </div>
</div>
